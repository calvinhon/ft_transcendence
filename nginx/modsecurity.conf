# ModSecurity configuration for OWASP CRS
# Enable ModSecurity
SecRuleEngine On

# Request body limit (10MB)
SecRequestBodyLimit 10485760
SecRequestBodyNoFilesLimit 1048576

# Response body limit (10MB)
SecResponseBodyLimit 10485760
SecResponseBodyLimitAction ProcessPartial

# Misc settings
SecTmpDir /tmp/
SecDataDir /tmp/

# File upload settings
SecUploadDir /tmp/
SecUploadFileMode 0600

# Log settings
SecAuditEngine RelevantOnly
SecAuditLogRelevantStatus "^(?:5|4(?!04))"
SecAuditLogParts ABDEFHIJKZ
SecAuditLog /var/log/modsecurity/audit.log

# Debug log
SecDebugLog /var/log/modsecurity/debug.log
SecDebugLogLevel 3

# Basic CRS rules
SecRule REQUEST_HEADERS:Content-Type "text/xml" \
  "id:200001,phase:1,pass,nolog"

# Block known malicious patterns
SecRule ARGS "@rx (?:union.*select|select.*from|insert.*into|delete.*from|drop.*table)" \
  "id:200002,phase:2,deny,log,status:403,msg:'SQL Injection attempt detected'"

SecRule ARGS "@rx <script[^>]*>" \
  "id:200003,phase:2,deny,log,status:403,msg:'XSS attempt detected'"

# Require Content-Type header for POST requests
SecRule REQUEST_METHOD "@streq POST" \
  "id:200004,phase:1,chain,log"
  SecRule REQUEST_HEADERS:Content-Type "!@rx ^(application|text)" \
    "msg:'Invalid Content-Type for POST request'"
